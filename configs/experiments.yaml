# SAFER-Bench Grid Search Experiments
# Test variations against the baseline configuration

# Reference to baseline config
baseline_config: "configs/baseline.yaml"

# Grid search parameters
grid_search:
  # Retrieval methods to compare
  retriever:
    - type: "FAISS-IVF"
      metric: "L2"
    - type: "FAISS-HNSW"
      metric: "cosine"
    - type: "BM25"
    - type: "Hybrid"  # BM25 + Dense

  # Merging strategies
  merger:
    - type: "RRF"
      k_rrf: [30, 60, 100]
    - type: "Score-avg"
    - type: "Borda"
    - type: "CombMNZ"

  # Language models to evaluate
  llm:
    - "HuggingFaceTB/SmolLM2-360M-Instruct"
    - "HuggingFaceTB/SmolLM2-1.7B-Instruct"
    - "Qwen/Qwen2.5-0.5B-Instruct"
    - "BioMistral/BioMistral-7B-Q4"  # Quantized for efficiency

  # Federation parameters
  num_data_owners: [2, 3, 5, 10]
  approval_rate: [0.5, 0.7, 0.9, 1.0]  # Simulated client participation

  # Retrieval parameters
  k_nn: [5, 8, 10, 15]

  # Privacy mechanisms
  privacy:
    - type: "none"
    - type: "DP"
      epsilon: [0.1, 1.0, 5.0]
    - type: "k-anon"
      k: [5, 10]


# Experiment settings
experiment:
  # How many parameter combinations to test (0 = all)
  max_trials: 0

  # Experiment execution
  num_runs: 3  # Repetitions per configuration
  parallel_jobs: 1  # Number of parallel experiments

  # Random seeds for reproducibility
  seeds: [42, 123, 456]

  # Output configuration
  output_dir: "results/grid_search/"
  save_predictions: true
  save_retrieved_docs: false

  # Resource limits
  timeout_per_query: 30  # seconds
  max_memory_per_client: "4GB"

# Evaluation metrics
metrics:
  primary: accuracy  # Main metric for model selection
  secondary:
    - answered_ratio  # Questions answered vs total
    - mean_query_time  # Average time per query
    - retrieval_precision  # Quality of retrieved documents
    - privacy_loss  # For privacy-preserving methods
    - communication_cost  # Bytes transmitted in federation

# Logging configuration
logging:
  level: INFO
  file: "experiments.log"
  console: true
  wandb:
    enabled: false
    project: "safer-bench"
    tags: ["grid_search", "fedrag"]
